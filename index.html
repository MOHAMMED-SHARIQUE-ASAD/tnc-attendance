<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE NEW COLLEGE - Attendance System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #8B0000 0%, #B22222 100%);
            min-height: 100vh;
            color: #333;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 450px;
            padding: 40px;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .college-logo {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(139, 0, 0, 0.3);
            border: 3px solid #8B0000;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .college-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 10px;
        }

        .college-name {
            color: #8B0000;
            font-size: 28px;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .college-tagline {
            color: #B22222;
            font-size: 18px;
            font-style: italic;
            margin-bottom: 10px;
            font-family: 'Times New Roman', serif;
        }

        .arabic-text {
            color: #8B0000;
            font-size: 24px;
            margin-bottom: 20px;
            font-family: 'Traditional Arabic', 'Times New Roman', serif;
            border-top: 2px solid #8B0000;
            border-bottom: 2px solid #8B0000;
            padding: 10px;
            background: #FFF0F0;
        }

        .arabic-text small {
            font-size: 14px;
            display: block;
            margin-top: 5px;
            color: #666;
            font-family: 'Segoe UI', sans-serif;
        }

        .role-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .role-btn {
            padding: 10px 20px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .role-btn.active {
            background: #8B0000;
            color: white;
            border-color: #8B0000;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #8B0000;
            box-shadow: 0 0 0 3px rgba(139, 0, 0, 0.1);
        }

        .input-group .hint {
            font-size: 12px;
            color: #8B0000;
            margin-top: 5px;
            font-style: italic;
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #8B0000 0%, #B22222 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(139, 0, 0, 0.3);
        }

        .dashboard {
            display: none;
            min-height: 100vh;
            background: #f5f5f5;
        }

        .dashboard.active {
            display: block;
        }

        .navbar {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn-nav {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #8B0000;
            display: none;
            transition: transform 0.2s ease;
        }

        .back-btn-nav:hover {
            transform: translateX(-3px);
        }

        .back-btn-nav.visible {
            display: block;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid #8B0000;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 5px;
        }

        .nav-brand h2 {
            color: #8B0000;
            font-size: 18px;
            margin: 0;
        }

        .nav-brand small {
            color: #B22222;
            font-size: 10px;
            display: block;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .refresh-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #8B0000;
            margin-right: 5px;
            transition: transform 0.5s ease;
        }
        
        .refresh-btn:hover {
            transform: rotate(180deg);
        }

        .menu-toggle {
            font-size: 24px;
            cursor: pointer;
            color: #8B0000;
        }

        .main-content {
            margin-top: 60px;
            margin-bottom: 70px;
            padding: 20px;
            min-height: calc(100vh - 130px);
            overflow-y: auto;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: #666;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            padding: 5px;
        }

        .nav-item.active {
            color: #8B0000;
        }

        .nav-item span:first-child {
            font-size: 20px;
        }

        .menu-full {
            position: fixed;
            top: 60px;
            left: 0;
            width: 100%;
            height: calc(100vh - 130px);
            background: white;
            z-index: 999;
            overflow-y: auto;
            padding: 20px;
            display: none;
        }

        .menu-full.open {
            display: block;
        }

        .menu-full .search-box {
            margin-bottom: 20px;
        }

        .menu-full .search-box input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
        }

        .menu-section {
            margin-bottom: 25px;
        }

        .menu-section h3 {
            color: #8B0000;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .menu-grid-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .menu-grid-item:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
        }

        .menu-grid-item span:first-child {
            font-size: 24px;
        }

        .menu-grid-item span:last-child {
            font-size: 14px;
            color: #333;
        }

        .recent-section {
            margin-bottom: 20px;
        }

        .recent-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .recent-header h3 {
            color: #8B0000;
            font-size: 16px;
        }

        .clear-all {
            color: #8B0000;
            font-size: 13px;
            cursor: pointer;
        }

        .recent-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .recent-item:hover {
            background: #f0f0f0;
        }

        .student-home {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .student-header {
            margin-bottom: 5px;
        }

        .student-header h1 {
            color: #333;
            font-size: 22px;
            margin-bottom: 5px;
        }

        .student-header p {
            color: #666;
            font-size: 14px;
        }

        .hours-grid {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            cursor: pointer;
        }

        .hour-box {
            flex: 1;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .hour-box:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .hour-box.present {
            background: #d4edda;
            border-color: #28a745;
        }

        .hour-box.absent {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .hour-box.late {
            background: #fff3cd;
            border-color: #ffc107;
        }

        .hour-box.letoff {
            background: #cce5ff;
            border-color: #004085;
        }

        .hour-box .hour {
            color: #333;
            font-size: 14px;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .hour-box .status {
            font-size: 12px;
            font-weight: 600;
        }

        .hour-box.present .status {
            color: #28a745;
        }

        .hour-box.absent .status {
            color: #dc3545;
        }

        .hour-box.late .status {
            color: #ffc107;
        }

        .hour-box.letoff .status {
            color: #004085;
        }

        .period-detail-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .period-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .period-detail-header h3 {
            color: #8B0000;
            font-size: 18px;
            font-weight: 600;
        }

        .period-detail-header .period-time {
            color: #666;
            font-size: 14px;
        }

        .period-detail-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .period-detail-row {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .period-detail-label {
            min-width: 100px;
            color: #666;
            font-size: 14px;
            font-weight: 500;
        }

        .period-detail-value {
            color: #333;
            font-size: 15px;
            font-weight: 500;
        }

        .period-detail-value.faculty {
            color: #8B0000;
            font-weight: 600;
        }

        .period-detail-value.status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .period-detail-value.status.present {
            background: #d4edda;
            color: #28a745;
        }

        .period-detail-value.status.absent {
            background: #f8d7da;
            color: #dc3545;
        }

        .period-detail-value.status.late {
            background: #fff3cd;
            color: #856404;
        }

        .period-detail-value.status.letoff {
            background: #cce5ff;
            color: #004085;
        }

        .period-detail-course {
            margin-top: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .period-detail-course h4 {
            color: #333;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .period-detail-course p {
            color: #666;
            font-size: 14px;
            margin-bottom: 3px;
        }

        .period-detail-course .course-code {
            color: #8B0000;
            font-size: 13px;
            font-weight: 600;
        }

        .class-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .class-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .class-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .class-title {
            color: #333;
            font-size: 16px;
            font-weight: 600;
        }

        .class-status {
            color: #28a745;
            font-size: 14px;
            font-weight: 600;
        }

        .faculty-name {
            color: #8B0000;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .class-details {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .view-all-link {
            text-align: right;
            margin: 15px 0;
        }

        .view-all-link a {
            color: #8B0000;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
        }

        .feedback-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .feedback-section p {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .feedback-btn {
            background: linear-gradient(135deg, #8B0000 0%, #B22222 100%);
            color: white;
            border: none;
            padding: 10px 30px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .feedback-btn:hover {
            transform: translateY(-2px);
        }

        .favorites-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            border-radius: 30px;
            padding: 10px 20px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .favorites-nav .title {
            color: #333;
            font-size: 16px;
            font-weight: 600;
        }

        .favorites-nav .actions {
            display: flex;
            gap: 20px;
        }

        .favorites-nav .actions span {
            color: #8B0000;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }

        .schedule-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .schedule-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .schedule-header h3 {
            color: #333;
            font-size: 16px;
            font-weight: 600;
        }

        .schedule-date {
            color: #8B0000;
            font-size: 14px;
        }

        .schedule-item {
            display: flex;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .schedule-item:last-child {
            border-bottom: none;
        }

        .schedule-time {
            font-weight: 600;
            color: #8B0000;
            min-width: 100px;
            font-size: 14px;
        }

        .schedule-details h4 {
            color: #333;
            font-size: 15px;
            margin-bottom: 3px;
        }

        .schedule-details p {
            color: #666;
            font-size: 13px;
        }

        .result-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-header h3 {
            color: #333;
            font-size: 16px;
            font-weight: 600;
        }

        .see-all {
            color: #8B0000;
            text-decoration: none;
            font-size: 13px;
        }

        .no-result {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .no-result p {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .no-result small {
            color: #999;
            font-size: 12px;
        }

        .semester-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .semester-stats {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 10px;
        }

        .stats-details {
            flex: 1;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #e0e0e0;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #666;
            font-size: 13px;
        }

        .stat-value {
            color: #333;
            font-weight: 600;
            font-size: 13px;
        }

        .percentage-circle {
            width: 80px;
            height: 80px;
            background: #8B0000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: bold;
            position: relative;
        }

        .percentage-circle::after {
            content: '%';
            font-size: 12px;
            position: absolute;
            top: 25px;
            right: 18px;
        }

        .notice-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .notice-content {
            text-align: center;
            padding: 20px;
        }

        .notice-icon {
            font-size: 30px;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        .notice-content h4 {
            color: #333;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .notice-content p {
            color: #999;
            font-size: 12px;
        }

        .events-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .events-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .events-header h3 {
            color: #333;
            font-size: 16px;
            font-weight: 600;
        }

        .event-item {
            display: flex;
            gap: 15px;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .event-item:last-child {
            border-bottom: none;
        }

        .event-date {
            width: 45px;
            text-align: center;
        }

        .event-date .day {
            color: #8B0000;
            font-size: 18px;
            font-weight: bold;
            line-height: 1;
        }

        .event-date .month {
            color: #666;
            font-size: 11px;
        }

        .event-details h4 {
            color: #333;
            font-size: 14px;
            margin-bottom: 3px;
        }

        .event-details p {
            color: #999;
            font-size: 12px;
        }

        .attendance-page {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .attendance-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .attendance-tab {
            padding: 8px 20px;
            border: none;
            background: none;
            color: #666;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .attendance-tab.active {
            background: #8B0000;
            color: white;
        }

        .course-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .course-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .course-header h3 {
            color: #333;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .course-faculty {
            color: #8B0000;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .course-stats {
            display: flex;
            gap: 20px;
            font-size: 14px;
        }

        .course-stats span {
            color: #28a745;
            font-weight: 600;
        }

        .month-grid {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .month-btn {
            padding: 8px 15px;
            border: 1px solid #e0e0e0;
            background: white;
            border-radius: 20px;
            color: #666;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .month-btn.active {
            background: #8B0000;
            color: white;
            border-color: #8B0000;
        }

        .month-btn:hover {
            background: #f0f0f0;
        }

        .attendance-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .attendance-table th {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            color: #666;
            font-size: 13px;
            font-weight: 600;
        }

        .attendance-table td {
            text-align: center;
            padding: 8px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
        }

        .status-present {
            color: #28a745;
            font-size: 18px;
        }

        .status-absent {
            color: #dc3545;
            font-size: 18px;
        }

        .status-late {
            color: #ffc107;
            font-size: 18px;
        }

        .status-letoff {
            color: #17a2b8;
            font-size: 18px;
        }

        .status-unmarked {
            color: #6c757d;
            font-size: 18px;
        }

        .status-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
            justify-content: center;
        }

        .status-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            cursor: default;
        }

        .status-btn.present {
            background: #d4edda;
            color: #28a745;
        }

        .status-btn.absent {
            background: #f8d7da;
            color: #dc3545;
        }

        .status-btn.late {
            background: #fff3cd;
            color: #856404;
        }

        .status-btn.letoff {
            background: #cce5ff;
            color: #004085;
        }

        .status-btn.unmarked {
            background: #e2e3e5;
            color: #383d41;
        }

        .term-stats {
            margin-top: 20px;
        }

        .term-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .term-header h3 {
            color: #333;
            font-size: 18px;
        }

        .term-header span {
            color: #8B0000;
            font-size: 24px;
            font-weight: bold;
        }

        .term-period {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
            color: #666;
        }

        .term-table {
            width: 100%;
            border-collapse: collapse;
        }

        .term-table th {
            text-align: left;
            padding: 10px;
            background: #f8f9fa;
            color: #666;
            font-size: 13px;
            font-weight: 600;
        }

        .term-table td {
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
        }

        .term-table tr:last-child td {
            border-bottom: none;
            background: #f8f9fa;
            font-weight: 600;
        }

        .mark-attendance-page {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }

        .period-selector {
            margin-bottom: 30px;
        }

        .period-selector h3 {
            color: #8B0000;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .period-grid {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .period-card {
            flex: 1;
            min-width: 100px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .period-card.selected {
            border-color: #8B0000;
            background: #fff0f0;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139,0,0,0.1);
        }

        .period-card .period-number {
            font-size: 20px;
            font-weight: bold;
            color: #8B0000;
            margin-bottom: 5px;
        }

        .period-card .period-time {
            font-size: 13px;
            color: #666;
        }

        .course-selector {
            margin-bottom: 30px;
        }

        .course-selector h3 {
            color: #8B0000;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .course-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            background: white;
        }

        .student-list {
            margin-bottom: 30px;
            max-height: 500px;
            overflow-y: auto;
        }

        .student-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .student-list-header h3 {
            color: #8B0000;
            font-size: 18px;
        }

        .student-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .student-list-item:hover {
            background: #f0f0f0;
            transform: translateX(5px);
        }

        .student-info {
            flex: 1;
        }

        .student-info h4 {
            color: #333;
            font-size: 15px;
            margin-bottom: 3px;
        }

        .student-info p {
            color: #666;
            font-size: 12px;
        }

        .student-status {
            display: flex;
            gap: 8px;
        }

        .status-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
            background: white;
            border: 2px solid #e0e0e0;
        }

        .status-option.present.active {
            background: #d4edda;
            border-color: #28a745;
            color: #28a745;
        }

        .status-option.absent.active {
            background: #f8d7da;
            border-color: #dc3545;
            color: #dc3545;
        }

        .status-option.late.active {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .status-option.letoff.active {
            background: #cce5ff;
            border-color: #004085;
            color: #004085;
        }

        .status-option:hover {
            transform: scale(1.1);
        }

        .mark-all-section {
            margin-bottom: 30px;
        }

        .mark-all-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .mark-all-btn {
            flex: 1;
            min-width: 100px;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mark-all-btn.present {
            background: #d4edda;
            color: #28a745;
            border: 2px solid #28a745;
        }

        .mark-all-btn.absent {
            background: #f8d7da;
            color: #dc3545;
            border: 2px solid #dc3545;
        }

        .mark-all-btn.late {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffc107;
        }

        .mark-all-btn.letoff {
            background: #cce5ff;
            color: #004085;
            border: 2px solid #004085;
        }

        .mark-all-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }

        .submit-attendance {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .submit-btn {
            padding: 12px 30px;
            background: #8B0000;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            background: #B22222;
            transform: translateY(-2px);
        }

        .cancel-btn {
            padding: 12px 30px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cancel-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            font-size: 18px;
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #8B0000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 12px 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1500;
            border-left: 4px solid #8B0000;
            font-size: 13px;
        }

        .notification.show {
            display: flex;
        }

        .notification.success {
            border-left-color: #28a745;
        }

        .notification.error {
            border-left-color: #dc3545;
        }

        .college-footer {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            color: #666;
            font-size: 12px;
            border-top: 1px solid #e0e0e0;
        }

        .arabic-footer {
            font-family: 'Traditional Arabic', 'Times New Roman', serif;
            font-size: 16px;
            color: #8B0000;
            margin-bottom: 5px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .stat-card .stat-title {
            color: #666;
            font-size: 13px;
            margin-bottom: 5px;
        }

        .stat-card .stat-value {
            color: #333;
            font-size: 24px;
            font-weight: bold;
        }

        .btn-primary {
            padding: 8px 16px;
            background: #8B0000;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: #B22222;
            transform: translateY(-2px);
        }

        .debug-panel {
            background: #f8f9fa;
            border: 2px solid #17a2b8;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-family: monospace;
        }

        .debug-panel h3 {
            color: #17a2b8;
            margin-bottom: 15px;
        }

        .debug-row {
            display: flex;
            margin-bottom: 10px;
            padding: 5px;
            border-bottom: 1px dashed #ccc;
        }

        .debug-label {
            font-weight: bold;
            width: 150px;
            color: #495057;
        }

        .debug-value {
            color: #212529;
            word-break: break-all;
        }

        .debug-success {
            color: #28a745;
            font-weight: bold;
        }

        .debug-error {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div>Loading data...</div>
    </div>

    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="college-logo">
                    <img src="TNC.png" alt="THE NEW COLLEGE Logo" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MCIgaGVpZ2h0PSI4MCIgdmlld0JveD0iMCAwIDgwIDgwIj48cmVjdCB3aWR0aD0iODAiIGhlaWdodD0iODAiIGZpbGw9IiM4QjAwMDAiLz48dGV4dCB4PSI0MCIgeT0iNDAiIGZvbnQtc2l6ZT0iMjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIGZpbGw9IndoaXRlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiPlROQzwvdGV4dD48L3N2Zz4=';">
                </div>
                <h1 class="college-name">THE NEW COLLEGE</h1>
                <div class="college-tagline">Empowering Education, Enriching Lives</div>
                <div class="arabic-text">
                    ÿ±Ÿéÿ®ŸêŸë ÿ≤ÿØŸíŸÜŸêŸä ÿπŸêŸÑŸíŸÖÿßŸã
                    <br>
                    <small>"MY LORD! INCREASE ME IN KNOWLEDGE"</small>
                </div>
            </div>
            
            <div class="role-selector">
                <button class="role-btn active" onclick="setRole('student')">Student</button>
                <button class="role-btn" onclick="setRole('staff')">Staff</button>
                <button class="role-btn" onclick="setRole('admin')">Admin</button>
            </div>

            <form id="loginForm" onsubmit="handleLogin(event)">
                <div id="studentFields">
                    <div class="input-group">
                        <label>üìã Register Number</label>
                        <input type="text" id="registerNumber" placeholder="Enter register number">
                    </div>
                    <div class="input-group">
                        <label>üîí Password</label>
                        <input type="password" id="password" placeholder="Enter password">
                        <div class="hint">Password is your register number</div>
                    </div>
                </div>

                <div id="staffAdminFields" style="display: none;">
                    <div class="input-group">
                        <label>üìß Email Address</label>
                        <input type="email" id="email" placeholder="Enter email" value="sa.abdulkadhar@thenewcollege.edu.in">
                    </div>
                    <div class="input-group">
                        <label>üîí Password</label>
                        <input type="password" id="adminPassword" placeholder="Enter password" value="staff">
                    </div>
                </div>

                <button type="submit" class="login-btn">Login to Dashboard</button>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <nav class="navbar">
            <div class="nav-left">
                <button class="back-btn-nav" id="backBtnNav" onclick="goBack()">‚Üê</button>
                <div class="nav-brand">
                    <div class="nav-logo">
                        <img src="TNC.png" alt="TNC" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgdmlld0JveD0iMCAwIDQwIDQwIj48cmVjdCB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIGZpbGw9IiM4QjAwMDAiLz48dGV4dCB4PSIyMCIgeT0iMjAiIGZvbnQtc2l6ZT0iMTIiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIGZpbGw9IndoaXRlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiPlROQzwvdGV4dD48L3N2Zz4=';">
                    </div>
                    <div>
                        <h2>THE NEW COLLEGE</h2>
                        <small>Est. 1951 | Chennai</small>
                    </div>
                </div>
            </div>
            <div class="nav-right">
                <button class="refresh-btn" onclick="refreshData()" title="Refresh data">‚Üª</button>
                <div class="menu-toggle" onclick="toggleMenu()">‚ò∞</div>
            </div>
        </nav>

        <!-- Full Page Menu -->
        <div class="menu-full" id="fullMenu">
            <div class="search-box">
                <input type="text" placeholder="Search" id="menuSearch" onkeyup="searchMenu(this.value)">
            </div>

            <div class="recent-section" id="recentSection">
                <div class="recent-header">
                    <h3>Recent</h3>
                    <span class="clear-all" onclick="clearRecent()">Clear all</span>
                </div>
                <div id="recentItems"></div>
            </div>

            <div class="menu-section">
                <h3>Menu</h3>
                <div class="menu-grid" id="menuGrid">
                    <!-- Menu items will be dynamically updated based on role -->
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent"></div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="switchTab('home')">
                <span>üè†</span>
                <span>Home</span>
            </div>
            <div class="nav-item" onclick="switchTab('menu')">
                <span>üìã</span>
                <span>Menu</span>
            </div>
            <div class="nav-item" onclick="switchTab('profile')">
                <span>üë§</span>
                <span>Profile</span>
            </div>
        </div>

        <!-- College Footer -->
        <div class="college-footer">
            <div class="arabic-footer">ÿ±Ÿéÿ®ŸêŸë ÿ≤ÿØŸíŸÜŸêŸä ÿπŸêŸÑŸíŸÖÿßŸã</div>
            <div>THE NEW COLLEGE | Established 1951 | Affiliated to University of Madras</div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <span id="notificationIcon">‚ÑπÔ∏è</span>
        <span id="notificationMessage"></span>
    </div>

<script>
    // ==================== APPS SCRIPT WEB APP URL ====================
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxoMEH6pVGT0ceRwKtK0JAZpfylpB5d7b8WR6PQSMuqhpcarJqDzaqZEaEH1WL25t5Tzw/exec';

    // ==================== APPLICATION STATE ====================
    let currentUser = null;
    let currentRole = 'student';
    let currentTab = 'home';
    let menuOpen = false;
    let recentItems = ['Library Go', 'Attendance'];
    let selectedPeriod = 1;
    let selectedCourse = null;
    let attendanceData = {};
    let expandedPeriod = null;
    let studentsList = [];
    
    // Navigation History
    let navigationHistory = [];
    let currentPage = 'home';

    // Auto-refresh interval
    let refreshInterval = null;

    // For hourly view
    let selectedMonth = 'November';
    let selectedYear = 2025;

    // ==================== STAFF MEMBERS ====================
    const staffMembers = [
        { name: 'Dr. P. Hakkim Divan Mydeen', email: 'p.hakkimdivanmydeen@thenewcollege.edu.in', password: 'staff', department: 'Computer Science', designation: 'Professor' },
        { name: 'Mr. S.A. Abdul Kadhar', email: 'sa.abdulkadhar@thenewcollege.edu.in', password: 'staff', department: 'Computer Science', designation: 'Assistant Professor' }
    ];

    // ==================== COURSES ====================
    const courses = [
        { id: 1, code: '20BJM608', name: 'Programming in ASP.NET', faculty: 'M M Syed Sulaiman', totalHours: 50 },
        { id: 2, code: '20BJM609', name: 'Operating Systems', faculty: 'N Anver Hussain', totalHours: 57 },
        { id: 3, code: '20BJMP607', name: 'Programming in ASP.NET PRACTICAL ‚Äì VII', faculty: 'Dr. S. SAKTHIVEL', totalHours: 65 },
        { id: 4, code: '20BJM610', name: 'Internet of Things', faculty: 'Dr. G NAJEEB AHMED', totalHours: 37 },
        { id: 5, code: '20BJMQ601', name: 'Mini Project', faculty: 'Dr. J. Abdul Rasheedh', totalHours: 35 }
    ];

    // ==================== ADMIN USER ====================
    const adminUser = {
        email: 'admin@thenewcollege.in',
        password: 'admin',
        name: 'Administrator'
    };

    // ==================== JSONP HELPER FUNCTION ====================
    function jsonp(url) {
        return new Promise((resolve, reject) => {
            const callbackName = 'callback_' + Date.now();
            
            window[callbackName] = function(data) {
                delete window[callbackName];
                document.head.removeChild(script);
                resolve(data);
            };
            
            const script = document.createElement('script');
            script.src = url + '&callback=' + callbackName;
            
            script.onerror = function(error) {
                delete window[callbackName];
                document.head.removeChild(script);
                reject(error);
            };
            
            document.head.appendChild(script);
        });
    }

    // ==================== LOAD STUDENTS FROM GOOGLE SHEETS ====================
    async function loadStudentsFromSheet() {
        try {
            showLoading();
            const url = APPS_SCRIPT_URL + '?action=getStudents&t=' + new Date().getTime();
            console.log('üîç Fetching students from:', url);
            
            const data = await jsonp(url);
            console.log('üì• Response:', data);
            
            if (data.error) {
                console.error('Sheet error:', data.error);
                showNotification(`Error: ${data.error}`, 'error');
                return [];
            }
            
            if (data.students && Array.isArray(data.students)) {
                studentsList = data.students;
                localStorage.setItem('students', JSON.stringify(studentsList));
                console.log(`‚úÖ Loaded ${studentsList.length} students`);
                
                if (currentRole !== 'student' && currentPage === 'home') {
                    showStaffDashboard();
                }
                
                showNotification(`Loaded ${studentsList.length} students`, 'success');
                return studentsList;
            } else {
                console.log('‚ö†Ô∏è No students found');
                studentsList = [];
                return [];
            }
        } catch (error) {
            console.error('Error loading students:', error);
            showNotification('Error connecting to Google Sheets', 'error');
            return [];
        } finally {
            hideLoading();
        }
    }

    // ==================== LOAD ATTENDANCE FROM SHEET ====================
    async function loadAttendanceFromSheet() {
        try {
            const url = APPS_SCRIPT_URL + '?action=getAttendance&t=' + new Date().getTime();
            console.log('Fetching attendance from:', url);
            
            const data = await jsonp(url);
            console.log('Attendance data received:', data);
            
            if (data.records) {
                attendanceData = data.records;
                localStorage.setItem('attendanceRecords', JSON.stringify(attendanceData));
                console.log('Loaded attendance records:', Object.keys(attendanceData).filter(key => !key.includes('_')).length);
                
                if (currentRole === 'student' && currentPage === 'attendance') {
                    showAttendance();
                } else if (currentRole === 'student' && currentPage === 'home') {
                    showStudentHome();
                }
            }
        } catch (error) {
            console.error('Error loading attendance:', error);
            const saved = localStorage.getItem('attendanceRecords');
            if (saved) {
                attendanceData = JSON.parse(saved);
            }
        }
    }

  // ==================== LIVE SAVE TO GOOGLE SHEETS ====================
async function saveAttendanceToSheet(records) {
    showLoading();
    try {
        console.log('Saving attendance records to Google Sheets:', records);
        
        // Use a CORS proxy to ensure it works from GitHub Pages
        const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
        const response = await fetch(proxyUrl + APPS_SCRIPT_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ records: records })
        });
        
        const result = await response.json();
        console.log('Google Sheets save result:', result);
        
        if (result.error) {
            throw new Error(result.error);
        }
        
        if (result.success) {
            // Update local data
            records.forEach(record => {
                const key = `${record.studentId}_${record.date}_${record.period}`;
                attendanceData[key] = record.status;
                attendanceData[key + '_faculty'] = record.faculty;
                attendanceData[key + '_course'] = record.course;
                attendanceData[key + '_studentName'] = record.studentName;
            });
            
            localStorage.setItem('attendanceRecords', JSON.stringify(attendanceData));
            showNotification(`‚úÖ Saved ${records.length} records to Google Sheets!`, 'success');
            
            // Immediately refresh attendance data for all students
            setTimeout(async () => {
                await loadAttendanceFromSheet();
                showNotification('Live data refreshed for all students!', 'success');
            }, 1000);
        }
        
    } catch (error) {
        console.error('Error saving to Google Sheets:', error);
        showNotification('‚ùå Failed to save to Google Sheets. Check connection.', 'error');
    } finally {
        hideLoading();
    }
}

    // ==================== TEST CONNECTION ====================
    async function testConnection() {
        showLoading();
        try {
            const url = APPS_SCRIPT_URL + '?action=test&t=' + new Date().getTime();
            const data = await jsonp(url);
            
            let message = '‚úÖ CONNECTION SUCCESSFUL!\n\n';
            message += `Sheets: ${data.sheets.join(', ')}\n`;
            message += `Students: ${data.studentCount}\n`;
            message += `Attendance Records: ${data.attendanceCount}\n`;
            message += `Sample Student: ${data.sampleStudent?.name || 'None'}`;
            
            alert(message);
            console.log('Test result:', data);
        } catch (error) {
            alert('‚ùå Connection failed: ' + error);
        } finally {
            hideLoading();
        }
    }
    // ==================== TEST LIVE CONNECTION ====================
async function testLiveConnection() {
    showLoading();
    try {
        const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
        const testRecord = [{
            date: new Date().toISOString().split('T')[0],
            studentId: 'TEST',
            studentName: 'Test Student',
            period: 0,
            status: 'test',
            faculty: 'System',
            course: 'Test'
        }];
        
        const response = await fetch(proxyUrl + APPS_SCRIPT_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ records: testRecord })
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('‚úÖ LIVE CONNECTION WORKING!\n\nYour attendance will save directly to Google Sheets and be visible to all students instantly.');
        } else {
            alert('‚ùå Connection failed: ' + (result.error || 'Unknown error'));
        }
    } catch (error) {
        alert('‚ùå Connection failed: ' + error);
    } finally {
        hideLoading();
    }
}

    // ==================== FORCE RELOAD STUDENTS ====================
    async function forceReloadStudents() {
        showLoading();
        try {
            const url = APPS_SCRIPT_URL + '?action=getStudents&t=' + new Date().getTime();
            const data = await jsonp(url);
            
            if (data.students && Array.isArray(data.students)) {
                studentsList = data.students;
                localStorage.setItem('students', JSON.stringify(studentsList));
                showNotification(`‚úÖ Loaded ${studentsList.length} students!`, 'success');
                if (currentPage === 'home') {
                    showStaffDashboard();
                } else if (currentPage === 'markAttendance') {
                    showMarkAttendance();
                } else if (currentPage === 'students') {
                    showStudentsList();
                }
            } else {
                showNotification('‚ùå No students found', 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showNotification('Error loading students', 'error');
        } finally {
            hideLoading();
        }
    }

    // ==================== SESSION MANAGEMENT ====================
    function loadSession() {
        const savedUser = localStorage.getItem('currentUser');
        const savedRole = localStorage.getItem('currentRole');
        const savedStudents = localStorage.getItem('students');
        const savedAttendance = localStorage.getItem('attendanceRecords');
        
        if (savedStudents) {
            studentsList = JSON.parse(savedStudents);
        }
        
        if (savedAttendance) {
            attendanceData = JSON.parse(savedAttendance);
        }
        
        if (savedUser) {
            currentUser = JSON.parse(savedUser);
            currentRole = savedRole || 'student';
            
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboard').classList.add('active');
            
            updateMenuForRole();
            
            if (currentRole === 'student') {
                showStudentHome();
            } else {
                showStaffDashboard();
            }
        }
    }

    function saveSession() {
        if (currentUser) {
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('currentRole', currentRole);
        }
    }

    function clearSession() {
        localStorage.removeItem('currentUser');
        localStorage.removeItem('currentRole');
        currentUser = null;
    }

    // ==================== AUTO-REFRESH ====================
    function startAutoRefresh() {
        if (refreshInterval) clearInterval(refreshInterval);
        refreshInterval = setInterval(() => {
            if (currentUser && currentRole === 'student') {
                loadAttendanceFromSheet();
            }
        }, 30000);
    }

    async function refreshData() {
        showLoading();
        await loadAttendanceFromSheet();
        await loadStudentsFromSheet();
        hideLoading();
        showNotification('Data refreshed!', 'success');
        
        if (currentRole === 'student') {
            if (currentPage === 'home') showStudentHome();
            else if (currentPage === 'attendance') showAttendance();
        } else {
            showStaffDashboard();
        }
    }

    // ==================== LOGIN HANDLER ====================
    function setRole(role) {
        currentRole = role;
        document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        document.getElementById('studentFields').style.display = role === 'student' ? 'block' : 'none';
        document.getElementById('staffAdminFields').style.display = role !== 'student' ? 'block' : 'none';
    }

    async function handleLogin(event) {
        event.preventDefault();
        
        if (currentRole === 'student') {
            const regNo = document.getElementById('registerNumber').value.trim();
            const password = document.getElementById('password').value.trim();

            showLoading();
            
            try {
                const students = await loadStudentsFromSheet();
                
                const student = students.find(s => 
                    s.reg == regNo && (s.password == password || s.password == regNo)
                );
                
                if (student) {
                    currentUser = {
                        reg: student.reg,
                        name: student.name,
                        role: 'student',
                        department: 'Computer Science',
                        semester: student.year || '1st',
                        batch: student.batch || 'A'
                    };
                    
                    saveSession();
                    
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('dashboard').classList.add('active');
                    
                    updateMenuForRole();
                    
                    navigationHistory = [];
                    currentPage = 'home';
                    
                    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                    document.querySelector('.nav-item[onclick*="home"]').classList.add('active');
                    
                    showNotification(`Welcome, ${student.name}!`, 'success');
                    showStudentHome();
                } else {
                    showNotification('Invalid Register Number or Password!', 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showNotification('Error connecting to server', 'error');
            } finally {
                hideLoading();
            }
        } else if (currentRole === 'staff') {
            const email = document.getElementById('email').value;
            const password = document.getElementById('adminPassword').value;

            const staff = staffMembers.find(s => s.email === email && s.password === password);

            if (staff) {
                currentUser = { ...staff, role: 'staff' };
                saveSession();
                
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('dashboard').classList.add('active');
                
                await loadStudentsFromSheet();
                await loadAttendanceFromSheet();
                
                updateMenuForRole();
                showStaffDashboard();
                
                showNotification(`Welcome, ${staff.name}!`, 'success');
            } else {
                showNotification('Invalid email or password!', 'error');
            }
        } else if (currentRole === 'admin') {
            const email = document.getElementById('email').value;
            const password = document.getElementById('adminPassword').value;

            if (email === adminUser.email && password === adminUser.password) {
                currentUser = { ...adminUser, role: 'admin' };
                saveSession();
                
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('dashboard').classList.add('active');
                
                await loadStudentsFromSheet();
                await loadAttendanceFromSheet();
                
                updateMenuForRole();
                showStaffDashboard();
                
                showNotification('Welcome, Admin!', 'success');
            } else {
                showNotification('Invalid admin credentials!', 'error');
            }
        }
    }

    // ==================== MENU FUNCTIONS ====================
    function updateMenuForRole() {
        const menuGrid = document.getElementById('menuGrid');
        
        if (currentRole === 'student') {
            menuGrid.innerHTML = `
                <div class="menu-grid-item" onclick="navigateTo('libraryGo')">
                    <span>üìö</span>
                    <span>Library Go</span>
                </div>
                <div class="menu-grid-item" onclick="navigateTo('attendance')">
                    <span>‚úÖ</span>
                    <span>Attendance</span>
                </div>
                <div class="menu-grid-item" onclick="navigateTo('fees')">
                    <span>üí∞</span>
                    <span>Fees</span>
                </div>
                <div class="menu-grid-item" onclick="navigateTo('myAccount')">
                    <span>üë§</span>
                    <span>My Account</span>
                </div>
                <div class="menu-grid-item" onclick="navigateTo('tutorials')">
                    <span>üìπ</span>
                    <span>Tutorials</span>
                </div>
            `;
        } else {
            menuGrid.innerHTML = `
                <div class="menu-grid-item" onclick="navigateTo('markAttendance')">
                    <span>‚úÖ</span>
                    <span>Mark Attendance</span>
                </div>
                <div class="menu-grid-item" onclick="navigateTo('departments')">
                    <span>üèõÔ∏è</span>
                    <span>Departments</span>
                </div>
                <div class="menu-grid-item" onclick="navigateTo('courses')">
                    <span>üìö</span>
                    <span>All Courses</span>
                </div>
                <div class="menu-grid-item" onclick="navigateTo('students')">
                    <span>üë•</span>
                    <span>Students List</span>
                </div>
                <div class="menu-grid-item" onclick="navigateTo('faculty')">
                    <span>üë®‚Äçüè´</span>
                    <span>Faculty List</span>
                </div>
                <div class="menu-grid-item" onclick="testConnection()">
                    <span>üîå</span>
                    <span>Test Connection</span>
                </div>
            `;
        }
    }

    function navigateTo(section) {
        document.getElementById('fullMenu').classList.remove('open');
        document.getElementById('mainContent').style.display = 'block';
        
        switch(section) {
            case 'markAttendance':
                currentPage = 'markAttendance';
                showMarkAttendance();
                break;
            case 'attendance':
                currentPage = 'attendance';
                showAttendance();
                break;
            case 'myAccount':
                currentPage = 'myAccount';
                showProfile();
                break;
            case 'departments':
                currentPage = 'departments';
                showDepartments();
                break;
            case 'courses':
                currentPage = 'courses';
                showAllCourses();
                break;
            case 'students':
                currentPage = 'students';
                showStudentsList();
                break;
            case 'faculty':
                currentPage = 'faculty';
                showFacultyList();
                break;
            default:
                currentPage = section;
                showPlaceholder(section);
        }
        
        document.getElementById('backBtnNav').classList.add('visible');
    }

    function switchTab(tab) {
        currentTab = tab;
        
        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
        event.target.closest('.nav-item').classList.add('active');

        if (tab === 'home') {
            document.getElementById('fullMenu').classList.remove('open');
            document.getElementById('mainContent').style.display = 'block';
            
            navigationHistory = [];
            currentPage = 'home';
            expandedPeriod = null;
            document.getElementById('backBtnNav').classList.remove('visible');
            
            if (currentUser?.role === 'student') {
                showStudentHome();
            } else {
                showStaffDashboard();
            }
        } else if (tab === 'menu') {
            toggleMenu();
        } else if (tab === 'profile') {
            document.getElementById('fullMenu').classList.remove('open');
            document.getElementById('mainContent').style.display = 'block';
            currentPage = 'myAccount';
            showProfile();
            document.getElementById('backBtnNav').classList.add('visible');
        }
    }

    function toggleMenu() {
        menuOpen = !menuOpen;
        document.getElementById('fullMenu').classList.toggle('open', menuOpen);
        document.getElementById('mainContent').style.display = menuOpen ? 'none' : 'block';
    }

    function goBack() {
        if (currentPage === 'home') return;
        
        if (currentRole === 'student') {
            showStudentHome();
            currentPage = 'home';
            document.getElementById('backBtnNav').classList.remove('visible');
        } else {
            showStaffDashboard();
            currentPage = 'home';
            document.getElementById('backBtnNav').classList.remove('visible');
        }
    }

    function showLoading() {
        document.getElementById('loadingOverlay').classList.add('active');
    }

    function hideLoading() {
        document.getElementById('loadingOverlay').classList.remove('active');
    }

    function searchMenu(query) {
        const items = document.querySelectorAll('.menu-grid-item');
        items.forEach(item => {
            const text = item.querySelector('span:last-child').textContent.toLowerCase();
            if (text.includes(query.toLowerCase())) {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });
    }

    function clearRecent() {
        recentItems = [];
        updateRecentItems();
    }

    function updateRecentItems() {
        const recentDiv = document.getElementById('recentItems');
        if (recentItems.length === 0) {
            recentDiv.innerHTML = '<div class="recent-item">No recent items</div>';
        } else {
            recentDiv.innerHTML = recentItems.map(item => {
                const section = item.toLowerCase().replace(/ /g, '');
                return `
                    <div class="recent-item" onclick="navigateTo('${section}')">
                        <span>${getIconForItem(item)}</span>
                        <span>${item}</span>
                    </div>
                `;
            }).join('');
        }
    }

    function getIconForItem(item) {
        const icons = {
            'Library Go': 'üìö',
            'Attendance': '‚úÖ',
            'Fees': 'üí∞',
            'My Account': 'üë§',
            'Tutorials': 'üìπ',
            'Departments': 'üèõÔ∏è',
            'All Courses': 'üìö',
            'Students List': 'üë•',
            'Faculty List': 'üë®‚Äçüè´'
        };
        return icons[item] || 'üìå';
    }

    // ==================== STAFF DASHBOARD ====================
    function showStaffDashboard() {
        const content = document.getElementById('mainContent');
        
        content.innerHTML = `
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-title">Students</div>
                    <div class="stat-value">${studentsList.length}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Staff</div>
                    <div class="stat-value">${staffMembers.length}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Courses</div>
                    <div class="stat-value">${courses.length}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Today's Date</div>
                    <div class="stat-value">${new Date().toLocaleDateString()}</div>
                </div>
            </div>

            <div class="table-container" style="background: white; border-radius: 15px; padding: 20px; margin-top: 20px;">
                <div class="table-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #8B0000; padding-bottom: 10px;">
                    <h3 style="color: #333; font-size: 18px;">Quick Actions</h3>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;">
                    <button class="btn-primary" onclick="navigateTo('markAttendance')" style="padding: 15px;">‚úÖ Mark Attendance</button>
                    <button class="btn-primary" onclick="navigateTo('departments')" style="padding: 15px;">üèõÔ∏è Departments</button>
                    <button class="btn-primary" onclick="navigateTo('courses')" style="padding: 15px;">üìö All Courses</button>
                    <button class="btn-primary" onclick="navigateTo('students')" style="padding: 15px;">üë• Students List</button>
                    <button class="btn-primary" onclick="navigateTo('faculty')" style="padding: 15px;">üë®‚Äçüè´ Faculty List</button>
                    <button class="btn-primary" onclick="testConnection()" style="padding: 15px; background: #28a745;">üîå Test Connection</button>
                    <button class="btn-primary" onclick="forceReloadStudents()" style="padding: 15px; background: #ffc107;">üîÑ Force Reload</button>
                </div>
            </div>
        `;
    }

    // ==================== MARK ATTENDANCE PAGE ====================
    async function showMarkAttendance() {
        const content = document.getElementById('mainContent');
        const today = new Date().toISOString().split('T')[0];

        if (studentsList.length === 0) {
            await loadStudentsFromSheet();
        }

        if (studentsList.length === 0) {
            content.innerHTML = `
                <div style="text-align: center; padding: 50px;">
                    <h3 style="color: #8B0000;">No Students Found</h3>
                    <p>Please add students to the Students sheet in Google Sheets.</p>
                    <button class="btn-primary" onclick="testConnection()" style="margin-top: 20px; padding: 10px 20px; background:#28a745;">
                        üîå Test Connection
                    </button>
                    <button class="btn-primary" onclick="forceReloadStudents()" style="margin-top: 20px; margin-left: 10px; padding: 10px 20px; background:#ffc107;">
                        üîÑ Force Reload
                    </button>
                </div>
            `;
            return;
        }

        content.innerHTML = `
            <div class="mark-attendance-page">
                <h2 style="color: #8B0000; margin-bottom: 20px;">Mark Attendance</h2>
                
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <p>Date: ${new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                    <p>Total Students: ${studentsList.length}</p>
                </div>
                
                <div class="period-selector">
                    <h3>Select Period</h3>
                    <div class="period-grid">
                        ${[1, 2, 3, 4, 5].map(period => `
                            <div class="period-card ${selectedPeriod === period ? 'selected' : ''}" onclick="selectPeriod(${period})">
                                <div class="period-number">Period ${period}</div>
                                <div class="period-time">${getPeriodTime(period)}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="course-selector">
                    <h3>Select Course</h3>
                    <select class="course-select" onchange="selectCourse(this.value)">
                        <option value="">Choose a course...</option>
                        ${courses.map(course => `
                            <option value="${course.id}" ${selectedCourse == course.id ? 'selected' : ''}>${course.code} - ${course.name}</option>
                        `).join('')}
                    </select>
                </div>

                ${selectedCourse ? `
                    <div class="mark-all-section">
                        <h3>Quick Mark All</h3>
                        <div class="mark-all-buttons">
                            <button class="mark-all-btn present" onclick="markAllStudents('present')">‚úÖ All Present</button>
                            <button class="mark-all-btn absent" onclick="markAllStudents('absent')">‚ùå All Absent</button>
                            <button class="mark-all-btn late" onclick="markAllStudents('late')">‚è∞ All Late</button>
                            <button class="mark-all-btn letoff" onclick="markAllStudents('letoff')">‚òë All Let-off</button>
                        </div>
                    </div>

                    <div class="student-list">
                        <div class="student-list-header">
                            <h3>Students (${studentsList.length})</h3>
                            <input type="text" placeholder="Search student..." style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;" onkeyup="searchStudents(this.value)">
                        </div>
                        <div id="studentListContainer">
                            ${studentsList.map(student => {
                                const key = `${student.reg}_${today}_${selectedPeriod}`;
                                const status = attendanceData[key] || 'unmarked';
                                return `
                                    <div class="student-list-item" id="student-${student.reg}">
                                        <div class="student-info">
                                            <h4>${student.name}</h4>
                                            <p>${student.reg} | Batch: ${student.batch || 'A'} | Year: ${student.year || '1st'}</p>
                                        </div>
                                        <div class="student-status">
                                            <div class="status-option present ${status === 'present' ? 'active' : ''}" onclick="setStudentStatus('${student.reg}', 'present')">‚úì</div>
                                            <div class="status-option absent ${status === 'absent' ? 'active' : ''}" onclick="setStudentStatus('${student.reg}', 'absent')">‚úó</div>
                                            <div class="status-option late ${status === 'late' ? 'active' : ''}" onclick="setStudentStatus('${student.reg}', 'late')">‚è∞</div>
                                            <div class="status-option letoff ${status === 'letoff' ? 'active' : ''}" onclick="setStudentStatus('${student.reg}', 'letoff')">‚òë</div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>

                    <div class="submit-attendance">
                        <button class="cancel-btn" onclick="resetAttendance()">Reset</button>
                        <button class="submit-btn" onclick="submitAttendance()">Submit Attendance</button>
                    </div>
                ` : `
                    <div style="text-align: center; padding: 50px; color: #666;">
                        Please select a course to start marking attendance
                    </div>
                `}
            </div>
        `;
    }

    function searchStudents(query) {
        const items = document.querySelectorAll('.student-list-item');
        const queryLower = query.toLowerCase();
        
        items.forEach(item => {
            const name = item.querySelector('.student-info h4').textContent.toLowerCase();
            const reg = item.querySelector('.student-info p').textContent;
            if (name.includes(queryLower) || reg.includes(query)) {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });
    }

    function selectPeriod(period) {
        selectedPeriod = period;
        showMarkAttendance();
    }

    function selectCourse(courseId) {
        selectedCourse = parseInt(courseId);
        showMarkAttendance();
    }

    function setStudentStatus(regNo, status) {
        if (!selectedCourse) return;
        
        const today = new Date().toISOString().split('T')[0];
        const key = `${regNo}_${today}_${selectedPeriod}`;
        attendanceData[key] = status;
        
        const studentDiv = document.getElementById(`student-${regNo}`);
        if (studentDiv) {
            const options = studentDiv.querySelectorAll('.status-option');
            options.forEach(opt => opt.classList.remove('active'));
            studentDiv.querySelector(`.status-option.${status}`).classList.add('active');
        }
    }

    function markAllStudents(status) {
        if (!selectedCourse) return;
        
        const today = new Date().toISOString().split('T')[0];
        
        studentsList.forEach(student => {
            const key = `${student.reg}_${today}_${selectedPeriod}`;
            attendanceData[key] = status;
            
            const studentDiv = document.getElementById(`student-${student.reg}`);
            if (studentDiv) {
                const options = studentDiv.querySelectorAll('.status-option');
                options.forEach(opt => opt.classList.remove('active'));
                studentDiv.querySelector(`.status-option.${status}`).classList.add('active');
            }
        });
    }

    function resetAttendance() {
        if (!selectedCourse) return;
        
        const today = new Date().toISOString().split('T')[0];
        
        studentsList.forEach(student => {
            const key = `${student.reg}_${today}_${selectedPeriod}`;
            delete attendanceData[key];
        });
        
        showMarkAttendance();
    }

    async function submitAttendance() {
        if (!selectedCourse) return;
        
        const today = new Date().toISOString().split('T')[0];
        const selectedCourseObj = courses.find(c => c.id == selectedCourse);
        
        const records = [];
        
        studentsList.forEach(student => {
            const key = `${student.reg}_${today}_${selectedPeriod}`;
            const status = attendanceData[key];
            if (status && status !== 'unmarked') {
                records.push({
                    date: today,
                    studentId: student.reg,
                    studentName: student.name,
                    period: selectedPeriod,
                    status: status,
                    faculty: currentUser.name,
                    course: selectedCourseObj ? `${selectedCourseObj.code}-${selectedCourseObj.name}` : 'Course'
                });
            }
        });
        
        if (records.length === 0) {
            showNotification('No attendance marked!', 'info');
            return;
        }
        
        await saveAttendanceToSheet(records);
        
        setTimeout(async () => {
            await loadAttendanceFromSheet();
        }, 2000);
        
        selectedCourse = null;
        showMarkAttendance();
    }

    // ==================== OTHER PAGE FUNCTIONS ====================
    function showStudentHome() {
        // Your existing showStudentHome function
        document.getElementById('mainContent').innerHTML = '<div>Student Home</div>';
    }

    function showAttendance() {
        document.getElementById('mainContent').innerHTML = '<div>Attendance Page</div>';
    }

    function showProfile() {
        document.getElementById('mainContent').innerHTML = '<div>Profile Page</div>';
    }

    function showDepartments() {
        document.getElementById('mainContent').innerHTML = '<div>Departments Page</div>';
    }

    function showAllCourses() {
        document.getElementById('mainContent').innerHTML = '<div>All Courses Page</div>';
    }

    function showStudentsList() {
        if (studentsList.length === 0) {
            document.getElementById('mainContent').innerHTML = '<div>No students found</div>';
            return;
        }
        let html = '<h2>Students List</h2><ul>';
        studentsList.forEach(s => html += `<li>${s.name} - ${s.reg}</li>`);
        html += '</ul>';
        document.getElementById('mainContent').innerHTML = html;
    }

    function showFacultyList() {
        let html = '<h2>Faculty List</h2><ul>';
        staffMembers.forEach(s => html += `<li>${s.name} - ${s.department}</li>`);
        html += '</ul>';
        document.getElementById('mainContent').innerHTML = html;
    }

    function showPlaceholder(page) {
        document.getElementById('mainContent').innerHTML = `<h2>${page} - Coming Soon</h2>`;
    }

    function getPeriodTime(period) {
        const times = {
            1: '09:00 - 10:00',
            2: '10:00 - 11:00',
            3: '11:00 - 12:00',
            4: '12:00 - 13:00',
            5: '14:00 - 15:00'
        };
        return times[period] || '';
    }

    // ==================== NOTIFICATION ====================
    function showNotification(message, type = 'info') {
        const notification = document.getElementById('notification');
        const icon = document.getElementById('notificationIcon');
        const msg = document.getElementById('notificationMessage');
        
        notification.className = `notification ${type}`;
        icon.textContent = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
        msg.textContent = message;
        notification.classList.add('show');
        
        setTimeout(() => notification.classList.remove('show'), 3000);
    }

    // ==================== LOGOUT ====================
    function logout() {
        clearSession();
        currentUser = null;
        selectedCourse = null;
        selectedPeriod = 1;
        document.getElementById('loginPage').style.display = 'flex';
        document.getElementById('dashboard').classList.remove('active');
        document.getElementById('registerNumber').value = '';
        document.getElementById('password').value = '';
        document.getElementById('email').value = '';
        document.getElementById('adminPassword').value = '';
        showNotification('Logged out successfully', 'info');
    }

    // ==================== INITIALIZE ====================
    document.addEventListener('DOMContentLoaded', async () => {
        setRole('student');
        await loadStudentsFromSheet();
        await loadAttendanceFromSheet();
        loadSession();
        startAutoRefresh();
        updateRecentItems();
    });
</script>
</body>
</html>
